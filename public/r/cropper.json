{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "cropper",
  "type": "registry:ui",
  "title": "Cropper",
  "description": "A cropper component.",
  "dependencies": [
    "@origin-space/image-cropper",
    "lucide-react"
  ],
  "files": [
    {
      "path": "registry/default/cropper/cropper.tsx",
      "content": "\"use client\";\r\n\r\nimport { Cropper as CropperPrimitive } from \"@origin-space/image-cropper\";\r\nimport { forwardRef, useCallback, useRef, useState } from \"react\";\r\nimport { \r\n  ZoomIn, \r\n  ZoomOut, \r\n  RotateCcw, \r\n  Download, \r\n  Crop,\r\n  Square,\r\n  Smartphone,\r\n  Monitor\r\n} from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface Area {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\ninterface CropData {\r\n  cropArea: Area;\r\n  zoom: number;\r\n  aspectRatio: number;\r\n}\r\n\r\ntype AspectRatioPreset = {\r\n  label: string;\r\n  value: number;\r\n  icon?: React.ComponentType<{ className?: string }>;\r\n};\r\n\r\nconst ASPECT_RATIO_PRESETS: AspectRatioPreset[] = [\r\n  { label: \"Free\", value: 0 },\r\n  { label: \"Square\", value: 1, icon: Square },\r\n  { label: \"Portrait\", value: 3/4, icon: Smartphone },\r\n  { label: \"Landscape\", value: 4/3, icon: Monitor },\r\n  { label: \"Widescreen\", value: 16/9, icon: Monitor },\r\n];\r\n\r\nconst createCropCanvas = (image: HTMLImageElement, cropArea: Area, isCircular: boolean = false): HTMLCanvasElement => {\r\n  const canvas = document.createElement('canvas');\r\n  const ctx = canvas.getContext('2d');\r\n  \r\n  if (!ctx) throw new Error('Failed to get canvas context');\r\n  \r\n  canvas.width = cropArea.width;\r\n  canvas.height = cropArea.height;\r\n  \r\n  if (isCircular) {\r\n    // Create circular clipping path\r\n    const centerX = cropArea.width / 2;\r\n    const centerY = cropArea.height / 2;\r\n    const radius = Math.min(centerX, centerY);\r\n    \r\n    ctx.beginPath();\r\n    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\r\n    ctx.clip();\r\n  }\r\n  \r\n  ctx.drawImage(\r\n    image,\r\n    cropArea.x,\r\n    cropArea.y,\r\n    cropArea.width,\r\n    cropArea.height,\r\n    0,\r\n    0,\r\n    cropArea.width,\r\n    cropArea.height\r\n  );\r\n  \r\n  return canvas;\r\n};\r\n\r\nconst downloadCroppedImage = (canvas: HTMLCanvasElement, filename: string = 'cropped-image.png') => {\r\n  const link = document.createElement('a');\r\n  link.download = filename;\r\n  link.href = canvas.toDataURL();\r\n  link.click();\r\n};\r\n\r\nconst getCroppedImageBlob = (canvas: HTMLCanvasElement): Promise<Blob> => {\r\n  return new Promise((resolve) => {\r\n    canvas.toBlob((blob) => {\r\n      if (blob) resolve(blob);\r\n    });\r\n  });\r\n};\r\n\r\nfunction Cropper({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof CropperPrimitive.Root>) {\r\n  return (\r\n    <CropperPrimitive.Root\r\n      data-slot=\"cropper\"\r\n      className={cn(\r\n        \"relative flex w-full cursor-move touch-none items-center justify-center overflow-hidden focus:outline-none\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CropperDescription({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof CropperPrimitive.Description>) {\r\n  return (\r\n    <CropperPrimitive.Description\r\n      data-slot=\"cropper-description\"\r\n      className={cn(\"sr-only\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CropperImage({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof CropperPrimitive.Image>) {\r\n  return (\r\n    <CropperPrimitive.Image\r\n      data-slot=\"cropper-image\"\r\n      className={cn(\r\n        \"pointer-events-none h-full w-full object-cover\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CropperCropArea({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof CropperPrimitive.CropArea>) {\r\n  return (\r\n    <CropperPrimitive.CropArea\r\n      data-slot=\"cropper-crop-area\"\r\n      className={cn(\r\n        \"pointer-events-none absolute border-3 border-white shadow-[0_0_0_9999px_rgba(0,0,0,0.3)] in-[[data-slot=cropper]:focus-visible]:ring-[3px] in-[[data-slot=cropper]:focus-visible]:ring-white/50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction CropperCropAreaCircular({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof CropperPrimitive.CropArea>) {\r\n  return (\r\n    <CropperPrimitive.CropArea\r\n      data-slot=\"cropper-crop-area\"\r\n      className={cn(\r\n        \"pointer-events-none absolute border-3 border-white rounded-full shadow-[0_0_0_9999px_rgba(0,0,0,0.3)] in-[[data-slot=cropper]:focus-visible]:ring-[3px] in-[[data-slot=cropper]:focus-visible]:ring-white/50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nconst CropperControls = forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, children, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex flex-wrap items-center justify-center gap-2 rounded-lg border border-border/60 bg-background/95 p-4 backdrop-blur supports-[backdrop-filter]:bg-background/60 shadow-[0_2px_8px_0_oklch(0.18_0_0_/_0.06)]\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n  </div>\r\n));\r\nCropperControls.displayName = \"CropperControls\";\r\n\r\nconst CropperZoomControls = forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement> & {\r\n    zoom: number;\r\n    minZoom?: number;\r\n    maxZoom?: number;\r\n    onZoomChange: (zoom: number) => void;\r\n    onReset?: () => void;\r\n    step?: number;\r\n  }\r\n>(({ \r\n  className, \r\n  zoom, \r\n  minZoom = 1, \r\n  maxZoom = 3, \r\n  onZoomChange, \r\n  onReset,\r\n  step = 0.1,\r\n  ...props \r\n}, ref) => {\r\n  const handleZoomIn = () => {\r\n    onZoomChange(Math.min(maxZoom, zoom + step));\r\n  };\r\n\r\n  const handleZoomOut = () => {\r\n    onZoomChange(Math.max(minZoom, zoom - step));\r\n  };\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      className={cn(\"flex items-center gap-1\", className)}\r\n      {...props}\r\n    >\r\n      <button\r\n        type=\"button\"\r\n        onClick={handleZoomOut}\r\n        disabled={zoom <= minZoom}\r\n        className=\"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-input/60 bg-background text-sm font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\"\r\n        aria-label=\"Zoom out\"\r\n      >\r\n        <ZoomOut className=\"h-4 w-4\" />\r\n      </button>\r\n      \r\n      <span className=\"min-w-[3rem] text-center text-sm text-muted-foreground\">\r\n        {Math.round(zoom * 100)}%\r\n      </span>\r\n      \r\n      <button\r\n        type=\"button\"\r\n        onClick={handleZoomIn}\r\n        disabled={zoom >= maxZoom}\r\n        className=\"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-input/60 bg-background text-sm font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\"\r\n        aria-label=\"Zoom in\"\r\n      >\r\n        <ZoomIn className=\"h-4 w-4\" />\r\n      </button>\r\n      \r\n      {onReset && (\r\n        <button\r\n          type=\"button\"\r\n          onClick={onReset}\r\n          className=\"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-input/60 bg-background text-sm font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\r\n          aria-label=\"Reset zoom\"\r\n        >\r\n          <RotateCcw className=\"h-4 w-4\" />\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\nCropperZoomControls.displayName = \"CropperZoomControls\";\r\n\r\nconst CropperAspectRatioControls = forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement> & {\r\n    aspectRatio: number;\r\n    onAspectRatioChange: (ratio: number) => void;\r\n    presets?: AspectRatioPreset[];\r\n  }\r\n>(({ \r\n  className, \r\n  aspectRatio, \r\n  onAspectRatioChange, \r\n  presets = ASPECT_RATIO_PRESETS,\r\n  ...props \r\n}, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"flex flex-wrap items-center gap-1\", className)}\r\n    {...props}\r\n  >\r\n    {presets.map((preset) => {\r\n      const Icon = preset.icon;\r\n      const isActive = aspectRatio === preset.value;\r\n      \r\n      return (\r\n        <button\r\n          key={preset.label}\r\n          type=\"button\"\r\n          onClick={() => onAspectRatioChange(preset.value)}\r\n          className={cn(\r\n            \"inline-flex h-9 items-center gap-1.5 rounded-lg border px-3 text-xs font-medium ring-offset-background transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n            isActive\r\n              ? \"border-primary bg-primary text-primary-foreground shadow-[0_1px_3px_0_oklch(0.18_0_0_/_0.08)]\"\r\n              : \"border-input/60 bg-background hover:bg-accent/80 hover:text-accent-foreground\"\r\n          )}\r\n          aria-label={`Set aspect ratio to ${preset.label}`}\r\n        >\r\n          {Icon && <Icon className=\"h-3 w-3\" />}\r\n          {preset.label}\r\n        </button>\r\n      );\r\n    })}\r\n  </div>\r\n));\r\nCropperAspectRatioControls.displayName = \"CropperAspectRatioControls\";\r\n\r\nconst CropperInfo = forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement> & {\r\n    cropData?: CropData;\r\n    showDetails?: boolean;\r\n  }\r\n>(({ className, cropData, showDetails = false, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"space-y-1 text-xs text-muted-foreground\", className)}\r\n    {...props}\r\n  >\r\n    {cropData && (\r\n      <>\r\n        <div className=\"flex items-center justify-between\">\r\n          <span>Zoom:</span>\r\n          <span>{Math.round(cropData.zoom * 100)}%</span>\r\n        </div>\r\n        {showDetails && (\r\n          <>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Aspect:</span>\r\n              <span>{cropData.aspectRatio === 0 ? \"Free\" : cropData.aspectRatio.toFixed(2)}</span>\r\n            </div>\r\n            <div className=\"flex items-center justify-between\">\r\n              <span>Size:</span>\r\n              <span>{Math.round(cropData.cropArea.width)} Ã— {Math.round(cropData.cropArea.height)}</span>\r\n            </div>\r\n          </>\r\n        )}\r\n      </>\r\n    )}\r\n  </div>\r\n));\r\nCropperInfo.displayName = \"CropperInfo\";\r\n\r\nconst CropperActions = forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement> & {\r\n    onDownload?: () => void;\r\n    onExport?: () => void;\r\n    downloadLabel?: string;\r\n    exportLabel?: string;\r\n  }\r\n>(({ \r\n  className, \r\n  onDownload, \r\n  onExport, \r\n  downloadLabel = \"Download\",\r\n  exportLabel = \"Export\",\r\n  ...props \r\n}, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"flex items-center gap-2\", className)}\r\n    {...props}\r\n  >\r\n    {onDownload && (\r\n      <button\r\n        type=\"button\"\r\n        onClick={onDownload}\r\n        className=\"inline-flex h-9 items-center gap-1.5 rounded-lg border border-input/60 bg-background px-3 text-xs font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\r\n      >\r\n        <Download className=\"h-3 w-3\" />\r\n        {downloadLabel}\r\n      </button>\r\n    )}\r\n    {onExport && (\r\n      <button\r\n        type=\"button\"\r\n        onClick={onExport}\r\n        className=\"inline-flex h-9 items-center gap-1.5 rounded-lg border border-input/60 bg-background px-3 text-xs font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\r\n      >\r\n        <Crop className=\"h-3 w-3\" />\r\n        {exportLabel}\r\n      </button>\r\n    )}\r\n  </div>\r\n));\r\nCropperActions.displayName = \"CropperActions\";\r\n\r\ninterface UseCropperOptions {\r\n  initialZoom?: number;\r\n  initialAspectRatio?: number;\r\n  minZoom?: number;\r\n  maxZoom?: number;\r\n  zoomStep?: number;\r\n}\r\n\r\nconst useCropper = (options: UseCropperOptions = {}) => {\r\n  const {\r\n    initialZoom = 1,\r\n    initialAspectRatio = 1,\r\n    minZoom = 1,\r\n    maxZoom = 3,\r\n    zoomStep = 0.1,\r\n  } = options;\r\n\r\n  const [zoom, setZoom] = useState(initialZoom);\r\n  const [aspectRatio, setAspectRatio] = useState(initialAspectRatio);\r\n  const [cropData, setCropData] = useState<CropData | undefined>();\r\n\r\n  const zoomRef = useRef(zoom);\r\n  const aspectRatioRef = useRef(aspectRatio);\r\n  \r\n  // Update refs when state changes\r\n  zoomRef.current = zoom;\r\n  aspectRatioRef.current = aspectRatio;\r\n\r\n  const handleZoomChange = useCallback((newZoom: number) => {\r\n    setZoom(Math.max(minZoom, Math.min(maxZoom, newZoom)));\r\n  }, [minZoom, maxZoom]);\r\n\r\n  const handleAspectRatioChange = useCallback((newRatio: number) => {\r\n    setAspectRatio(newRatio);\r\n  }, []);\r\n\r\n  const handleCropChange = useCallback((cropArea: Area | null) => {\r\n    if (cropArea) {\r\n      setCropData({\r\n        cropArea,\r\n        zoom: zoomRef.current,\r\n        aspectRatio: aspectRatioRef.current,\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  const reset = useCallback(() => {\r\n    setZoom(initialZoom);\r\n    setAspectRatio(initialAspectRatio);\r\n  }, [initialZoom, initialAspectRatio]);\r\n\r\n  const exportCrop = useCallback(async (imageElement: HTMLImageElement, filename?: string) => {\r\n    if (!cropData) return null;\r\n    \r\n    const canvas = createCropCanvas(imageElement, cropData.cropArea);\r\n    \r\n    if (filename) {\r\n      downloadCroppedImage(canvas, filename);\r\n    }\r\n    \r\n    return {\r\n      canvas,\r\n      blob: await getCroppedImageBlob(canvas),\r\n      dataUrl: canvas.toDataURL(),\r\n    };\r\n  }, [cropData]);\r\n\r\n  return {\r\n    zoom,\r\n    aspectRatio,\r\n    cropData,\r\n    setZoom: handleZoomChange,\r\n    setAspectRatio: handleAspectRatioChange,\r\n    onCropChange: handleCropChange,\r\n    reset,\r\n    exportCrop,\r\n    config: {\r\n      minZoom,\r\n      maxZoom,\r\n      zoomStep,\r\n    },\r\n  };\r\n};\r\n\r\nexport { \r\n  Cropper, \r\n  CropperDescription, \r\n  CropperImage, \r\n  CropperCropArea,\r\n  CropperCropAreaCircular,\r\n  CropperControls,\r\n  CropperZoomControls,\r\n  CropperAspectRatioControls,\r\n  CropperInfo,\r\n  CropperActions,\r\n  useCropper,\r\n  createCropCanvas,\r\n  downloadCroppedImage,\r\n  getCroppedImageBlob,\r\n  ASPECT_RATIO_PRESETS,\r\n  type Area,\r\n  type CropData,\r\n  type AspectRatioPreset,\r\n};\r\n",
      "type": "registry:ui",
      "target": "components/ui/cubby-ui/cropper.tsx"
    }
  ]
}