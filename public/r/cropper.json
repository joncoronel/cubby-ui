{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "cropper",
  "type": "registry:ui",
  "title": "Cropper",
  "description": "A cropper component.",
  "dependencies": [
    "@origin-space/image-cropper",
    "lucide-react"
  ],
  "files": [
    {
      "path": "registry/default/cropper/cropper.tsx",
      "content": "\"use client\";\n\nimport { Cropper as CropperPrimitive } from \"@origin-space/image-cropper\";\nimport { forwardRef, useCallback, useRef, useState } from \"react\";\nimport { \n  ZoomIn, \n  ZoomOut, \n  RotateCcw, \n  Download, \n  Crop,\n  Square,\n  Smartphone,\n  Monitor\n} from \"lucide-react\";\n\nimport { cn } from \"@/lib/utils\";\n\ninterface Area {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\ninterface CropData {\n  cropArea: Area;\n  zoom: number;\n  aspectRatio: number;\n}\n\ntype AspectRatioPreset = {\n  label: string;\n  value: number;\n  icon?: React.ComponentType<{ className?: string }>;\n};\n\nconst ASPECT_RATIO_PRESETS: AspectRatioPreset[] = [\n  { label: \"Free\", value: 0 },\n  { label: \"Square\", value: 1, icon: Square },\n  { label: \"Portrait\", value: 3/4, icon: Smartphone },\n  { label: \"Landscape\", value: 4/3, icon: Monitor },\n  { label: \"Widescreen\", value: 16/9, icon: Monitor },\n];\n\nconst createCropCanvas = (image: HTMLImageElement, cropArea: Area, isCircular: boolean = false): HTMLCanvasElement => {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  \n  if (!ctx) throw new Error('Failed to get canvas context');\n  \n  canvas.width = cropArea.width;\n  canvas.height = cropArea.height;\n  \n  if (isCircular) {\n    // Create circular clipping path\n    const centerX = cropArea.width / 2;\n    const centerY = cropArea.height / 2;\n    const radius = Math.min(centerX, centerY);\n    \n    ctx.beginPath();\n    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);\n    ctx.clip();\n  }\n  \n  ctx.drawImage(\n    image,\n    cropArea.x,\n    cropArea.y,\n    cropArea.width,\n    cropArea.height,\n    0,\n    0,\n    cropArea.width,\n    cropArea.height\n  );\n  \n  return canvas;\n};\n\nconst downloadCroppedImage = (canvas: HTMLCanvasElement, filename: string = 'cropped-image.png') => {\n  const link = document.createElement('a');\n  link.download = filename;\n  link.href = canvas.toDataURL();\n  link.click();\n};\n\nconst getCroppedImageBlob = (canvas: HTMLCanvasElement): Promise<Blob> => {\n  return new Promise((resolve) => {\n    canvas.toBlob((blob) => {\n      if (blob) resolve(blob);\n    });\n  });\n};\n\nfunction Cropper({\n  className,\n  ...props\n}: React.ComponentProps<typeof CropperPrimitive.Root>) {\n  return (\n    <CropperPrimitive.Root\n      data-slot=\"cropper\"\n      className={cn(\n        \"relative flex w-full cursor-move touch-none items-center justify-center overflow-hidden focus:outline-none\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CropperDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof CropperPrimitive.Description>) {\n  return (\n    <CropperPrimitive.Description\n      data-slot=\"cropper-description\"\n      className={cn(\"sr-only\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction CropperImage({\n  className,\n  ...props\n}: React.ComponentProps<typeof CropperPrimitive.Image>) {\n  return (\n    <CropperPrimitive.Image\n      data-slot=\"cropper-image\"\n      className={cn(\n        \"pointer-events-none h-full w-full object-cover\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CropperCropArea({\n  className,\n  ...props\n}: React.ComponentProps<typeof CropperPrimitive.CropArea>) {\n  return (\n    <CropperPrimitive.CropArea\n      data-slot=\"cropper-crop-area\"\n      className={cn(\n        \"pointer-events-none absolute border-3 border-white shadow-[0_0_0_9999px_rgba(0,0,0,0.3)] in-[[data-slot=cropper]:focus-visible]:ring-[3px] in-[[data-slot=cropper]:focus-visible]:ring-white/50\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction CropperCropAreaCircular({\n  className,\n  ...props\n}: React.ComponentProps<typeof CropperPrimitive.CropArea>) {\n  return (\n    <CropperPrimitive.CropArea\n      data-slot=\"cropper-crop-area\"\n      className={cn(\n        \"pointer-events-none absolute border-3 border-white rounded-full shadow-[0_0_0_9999px_rgba(0,0,0,0.3)] in-[[data-slot=cropper]:focus-visible]:ring-[3px] in-[[data-slot=cropper]:focus-visible]:ring-white/50\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nconst CropperControls = forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, children, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center justify-center gap-2 rounded-lg border border-border/60 bg-background/95 p-4 backdrop-blur supports-[backdrop-filter]:bg-background/60 shadow-[0_2px_8px_0_oklch(0.18_0_0_/_0.06)]\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n  </div>\n));\nCropperControls.displayName = \"CropperControls\";\n\nconst CropperZoomControls = forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    zoom: number;\n    minZoom?: number;\n    maxZoom?: number;\n    onZoomChange: (zoom: number) => void;\n    onReset?: () => void;\n    step?: number;\n  }\n>(({ \n  className, \n  zoom, \n  minZoom = 1, \n  maxZoom = 3, \n  onZoomChange, \n  onReset,\n  step = 0.1,\n  ...props \n}, ref) => {\n  const handleZoomIn = () => {\n    onZoomChange(Math.min(maxZoom, zoom + step));\n  };\n\n  const handleZoomOut = () => {\n    onZoomChange(Math.max(minZoom, zoom - step));\n  };\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\"flex items-center gap-1\", className)}\n      {...props}\n    >\n      <button\n        type=\"button\"\n        onClick={handleZoomOut}\n        disabled={zoom <= minZoom}\n        className=\"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-input/60 bg-background text-sm font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\"\n        aria-label=\"Zoom out\"\n      >\n        <ZoomOut className=\"h-4 w-4\" />\n      </button>\n      \n      <span className=\"min-w-[3rem] text-center text-sm text-muted-foreground\">\n        {Math.round(zoom * 100)}%\n      </span>\n      \n      <button\n        type=\"button\"\n        onClick={handleZoomIn}\n        disabled={zoom >= maxZoom}\n        className=\"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-input/60 bg-background text-sm font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\"\n        aria-label=\"Zoom in\"\n      >\n        <ZoomIn className=\"h-4 w-4\" />\n      </button>\n      \n      {onReset && (\n        <button\n          type=\"button\"\n          onClick={onReset}\n          className=\"inline-flex h-9 w-9 items-center justify-center rounded-lg border border-input/60 bg-background text-sm font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n          aria-label=\"Reset zoom\"\n        >\n          <RotateCcw className=\"h-4 w-4\" />\n        </button>\n      )}\n    </div>\n  );\n});\nCropperZoomControls.displayName = \"CropperZoomControls\";\n\nconst CropperAspectRatioControls = forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    aspectRatio: number;\n    onAspectRatioChange: (ratio: number) => void;\n    presets?: AspectRatioPreset[];\n  }\n>(({ \n  className, \n  aspectRatio, \n  onAspectRatioChange, \n  presets = ASPECT_RATIO_PRESETS,\n  ...props \n}, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-wrap items-center gap-1\", className)}\n    {...props}\n  >\n    {presets.map((preset) => {\n      const Icon = preset.icon;\n      const isActive = aspectRatio === preset.value;\n      \n      return (\n        <button\n          key={preset.label}\n          type=\"button\"\n          onClick={() => onAspectRatioChange(preset.value)}\n          className={cn(\n            \"inline-flex h-9 items-center gap-1.5 rounded-lg border px-3 text-xs font-medium ring-offset-background transition-colors duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n            isActive\n              ? \"border-primary bg-primary text-primary-foreground shadow-[0_1px_3px_0_oklch(0.18_0_0_/_0.08)]\"\n              : \"border-input/60 bg-background hover:bg-accent/80 hover:text-accent-foreground\"\n          )}\n          aria-label={`Set aspect ratio to ${preset.label}`}\n        >\n          {Icon && <Icon className=\"h-3 w-3\" />}\n          {preset.label}\n        </button>\n      );\n    })}\n  </div>\n));\nCropperAspectRatioControls.displayName = \"CropperAspectRatioControls\";\n\nconst CropperInfo = forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    cropData?: CropData;\n    showDetails?: boolean;\n  }\n>(({ className, cropData, showDetails = false, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"space-y-1 text-xs text-muted-foreground\", className)}\n    {...props}\n  >\n    {cropData && (\n      <>\n        <div className=\"flex items-center justify-between\">\n          <span>Zoom:</span>\n          <span>{Math.round(cropData.zoom * 100)}%</span>\n        </div>\n        {showDetails && (\n          <>\n            <div className=\"flex items-center justify-between\">\n              <span>Aspect:</span>\n              <span>{cropData.aspectRatio === 0 ? \"Free\" : cropData.aspectRatio.toFixed(2)}</span>\n            </div>\n            <div className=\"flex items-center justify-between\">\n              <span>Size:</span>\n              <span>{Math.round(cropData.cropArea.width)} Ã— {Math.round(cropData.cropArea.height)}</span>\n            </div>\n          </>\n        )}\n      </>\n    )}\n  </div>\n));\nCropperInfo.displayName = \"CropperInfo\";\n\nconst CropperActions = forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & {\n    onDownload?: () => void;\n    onExport?: () => void;\n    downloadLabel?: string;\n    exportLabel?: string;\n  }\n>(({ \n  className, \n  onDownload, \n  onExport, \n  downloadLabel = \"Download\",\n  exportLabel = \"Export\",\n  ...props \n}, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center gap-2\", className)}\n    {...props}\n  >\n    {onDownload && (\n      <button\n        type=\"button\"\n        onClick={onDownload}\n        className=\"inline-flex h-9 items-center gap-1.5 rounded-lg border border-input/60 bg-background px-3 text-xs font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n      >\n        <Download className=\"h-3 w-3\" />\n        {downloadLabel}\n      </button>\n    )}\n    {onExport && (\n      <button\n        type=\"button\"\n        onClick={onExport}\n        className=\"inline-flex h-9 items-center gap-1.5 rounded-lg border border-input/60 bg-background px-3 text-xs font-medium ring-offset-background transition-colors duration-200 hover:bg-accent/80 hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n      >\n        <Crop className=\"h-3 w-3\" />\n        {exportLabel}\n      </button>\n    )}\n  </div>\n));\nCropperActions.displayName = \"CropperActions\";\n\ninterface UseCropperOptions {\n  initialZoom?: number;\n  initialAspectRatio?: number;\n  minZoom?: number;\n  maxZoom?: number;\n  zoomStep?: number;\n}\n\nconst useCropper = (options: UseCropperOptions = {}) => {\n  const {\n    initialZoom = 1,\n    initialAspectRatio = 1,\n    minZoom = 1,\n    maxZoom = 3,\n    zoomStep = 0.1,\n  } = options;\n\n  const [zoom, setZoom] = useState(initialZoom);\n  const [aspectRatio, setAspectRatio] = useState(initialAspectRatio);\n  const [cropData, setCropData] = useState<CropData | undefined>();\n\n  const zoomRef = useRef(zoom);\n  const aspectRatioRef = useRef(aspectRatio);\n  \n  // Update refs when state changes\n  zoomRef.current = zoom;\n  aspectRatioRef.current = aspectRatio;\n\n  const handleZoomChange = useCallback((newZoom: number) => {\n    setZoom(Math.max(minZoom, Math.min(maxZoom, newZoom)));\n  }, [minZoom, maxZoom]);\n\n  const handleAspectRatioChange = useCallback((newRatio: number) => {\n    setAspectRatio(newRatio);\n  }, []);\n\n  const handleCropChange = useCallback((cropArea: Area | null) => {\n    if (cropArea) {\n      setCropData({\n        cropArea,\n        zoom: zoomRef.current,\n        aspectRatio: aspectRatioRef.current,\n      });\n    }\n  }, []);\n\n  const reset = useCallback(() => {\n    setZoom(initialZoom);\n    setAspectRatio(initialAspectRatio);\n  }, [initialZoom, initialAspectRatio]);\n\n  const exportCrop = useCallback(async (imageElement: HTMLImageElement, filename?: string) => {\n    if (!cropData) return null;\n    \n    const canvas = createCropCanvas(imageElement, cropData.cropArea);\n    \n    if (filename) {\n      downloadCroppedImage(canvas, filename);\n    }\n    \n    return {\n      canvas,\n      blob: await getCroppedImageBlob(canvas),\n      dataUrl: canvas.toDataURL(),\n    };\n  }, [cropData]);\n\n  return {\n    zoom,\n    aspectRatio,\n    cropData,\n    setZoom: handleZoomChange,\n    setAspectRatio: handleAspectRatioChange,\n    onCropChange: handleCropChange,\n    reset,\n    exportCrop,\n    config: {\n      minZoom,\n      maxZoom,\n      zoomStep,\n    },\n  };\n};\n\nexport { \n  Cropper, \n  CropperDescription, \n  CropperImage, \n  CropperCropArea,\n  CropperCropAreaCircular,\n  CropperControls,\n  CropperZoomControls,\n  CropperAspectRatioControls,\n  CropperInfo,\n  CropperActions,\n  useCropper,\n  createCropCanvas,\n  downloadCroppedImage,\n  getCroppedImageBlob,\n  ASPECT_RATIO_PRESETS,\n  type Area,\n  type CropData,\n  type AspectRatioPreset,\n};\n",
      "type": "registry:ui",
      "target": "components/ui/cubby-ui/cropper.tsx"
    }
  ]
}