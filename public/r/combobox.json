{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "combobox",
  "type": "registry:ui",
  "title": "Combobox",
  "description": "A combobox component.",
  "dependencies": [
    "lucide-react"
  ],
  "registryDependencies": [
    "@cubby-ui/label",
    "@cubby-ui/scroll-area"
  ],
  "files": [
    {
      "path": "registry/default/combobox/combobox.tsx",
      "content": "\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { X, CheckIcon, ChevronDown } from \"lucide-react\";\r\nimport { Label } from \"@/registry/default/label/label\";\r\nimport {\r\n  ScrollArea,\r\n  type ScrollAreaProps,\r\n} from \"@/registry/default/scroll-area/scroll-area\";\r\nimport { Combobox as BaseCombobox } from \"@base-ui/react/combobox\";\r\n\r\nconst useFilter = BaseCombobox.useFilter;\r\n\r\nconst ComboboxContext = React.createContext<{\r\n  id: string;\r\n  chipsRef: React.RefObject<HTMLDivElement | null>;\r\n} | null>(null);\r\n\r\nfunction Combobox<Value, Multiple extends boolean | undefined = false>(\r\n  props: BaseCombobox.Root.Props<Value, Multiple>,\r\n): React.JSX.Element {\r\n  const id = React.useId();\r\n  const chipsRef = React.useRef<HTMLDivElement | null>(null);\r\n\r\n  const contextValue = React.useMemo(() => ({ id, chipsRef }), [id]);\r\n\r\n  return (\r\n    <ComboboxContext.Provider value={contextValue}>\r\n      <BaseCombobox.Root data-slot=\"combobox\" {...props} />\r\n    </ComboboxContext.Provider>\r\n  );\r\n}\r\n\r\nfunction ComboboxInput({\r\n  id: idProp,\r\n  className,\r\n  ...props\r\n}: BaseCombobox.Input.Props) {\r\n  const context = React.useContext(ComboboxContext);\r\n  const id = idProp ?? context?.id;\r\n\r\n  return (\r\n    <BaseCombobox.Input\r\n      id={id}\r\n      data-slot=\"combobox-input\"\r\n      className={cn(\r\n        \"placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground bg-input dark:bg-input/30 flex h-10 w-full min-w-0 rounded-lg border bg-clip-padding px-3 text-base font-normal shadow-xs disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-60 sm:h-9 md:text-sm\",\r\n        \"file:text-foreground file:inline-flex file:h-7 file:rounded-md file:border-0 file:bg-transparent file:text-sm file:font-medium\",\r\n        \"focus-visible:outline-ring/50 outline-0 outline-offset-0 outline-transparent transition-[outline-width,outline-offset,outline-color] duration-100 ease-out outline-solid focus-visible:outline-2 focus-visible:outline-offset-2\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxInputWrapper({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<\"div\">) {\r\n  return (\r\n    <div\r\n      data-slot=\"combobox-input-wrapper\"\r\n      className={cn(\r\n        \"relative\",\r\n        // Auto-adjust input padding based on buttons present (right-3 = 0.75rem, button = 1rem)\r\n        \"has-data-[slot=combobox-clear]:**:data-[slot=combobox-input]:pr-7\",\r\n        \"has-data-[slot=combobox-trigger]:**:data-[slot=combobox-input]:pr-7\",\r\n        // Both buttons present (0.75rem + 1rem + 0.5rem gap + 1rem button = 3.25rem)\r\n        \"has-data-[slot=combobox-clear]:has-data-[slot=combobox-trigger]:**:data-[slot=combobox-input]:pr-13\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxChipInput({\r\n  id: idProp,\r\n  className,\r\n  ...props\r\n}: BaseCombobox.Input.Props) {\r\n  const context = React.useContext(ComboboxContext);\r\n  const id = idProp ?? context?.id;\r\n\r\n  return (\r\n    <BaseCombobox.Input\r\n      id={id}\r\n      data-slot=\"combobox-input\"\r\n      className={cn(\r\n        \"placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground h-7 min-w-12 flex-1 rounded-none border-none bg-transparent p-0 pl-1.5 text-base font-normal shadow-none outline-none focus-visible:ring-0 focus-visible:ring-offset-0 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-60 sm:h-6 md:text-sm\",\r\n\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxTrigger({ className, ...props }: BaseCombobox.Trigger.Props) {\r\n  return (\r\n    <BaseCombobox.Trigger\r\n      data-slot=\"combobox-trigger\"\r\n      aria-label=\"Open popup\"\r\n      className={cn(\r\n        \"inline-flex size-4 cursor-pointer items-center justify-center rounded-md border-none bg-transparent p-0 text-sm font-medium transition-colors disabled:pointer-events-none disabled:opacity-60\",\r\n        \"focus-visible:border-ring focus-visible:ring-ring/30 focus-visible:ring-3\",\r\n\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      <ChevronDown className=\"h-4 w-4\" />\r\n    </BaseCombobox.Trigger>\r\n  );\r\n}\r\n\r\nfunction ComboboxIcon({ className, ...props }: BaseCombobox.Icon.Props) {\r\n  return (\r\n    <BaseCombobox.Icon\r\n      data-slot=\"combobox-icon\"\r\n      className={cn(\"ml-2 h-4 w-4 shrink-0 opacity-50\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxClear({ className, ...props }: BaseCombobox.Clear.Props) {\r\n  return (\r\n    <BaseCombobox.Clear\r\n      data-slot=\"combobox-clear\"\r\n      aria-label=\"Clear selection\"\r\n      className={cn(\r\n        \"inline-flex h-4 w-4 cursor-pointer items-center justify-center rounded-sm opacity-70 transition-[opacity,scale,transform,translate] hover:opacity-100 disabled:pointer-events-none\",\r\n        \"focus-visible:border-ring focus-visible:ring-ring/30 duration-100 outline-none focus-visible:ring-3\",\r\n        \"data-ending-style:translate-x-1 data-ending-style:opacity-0 data-starting-style:translate-x-1 data-starting-style:opacity-0\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      <X className=\"h-4 w-4\" />\r\n    </BaseCombobox.Clear>\r\n  );\r\n}\r\n\r\nfunction ComboboxValue({ ...props }: BaseCombobox.Value.Props) {\r\n  return <BaseCombobox.Value data-slot=\"combobox-value\" {...props} />;\r\n}\r\n\r\nfunction ComboboxPortal({ ...props }: BaseCombobox.Portal.Props) {\r\n  return <BaseCombobox.Portal data-slot=\"combobox-portal\" {...props} />;\r\n}\r\n\r\nfunction ComboboxBackdrop({\r\n  className,\r\n  ...props\r\n}: BaseCombobox.Backdrop.Props) {\r\n  return (\r\n    <BaseCombobox.Backdrop\r\n      data-slot=\"combobox-backdrop\"\r\n      className={cn(\r\n        \"fixed inset-0 z-30 bg-black/50 data-ending-style:opacity-0 data-starting-style:opacity-0\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxPositioner({\r\n  className,\r\n  ...props\r\n}: BaseCombobox.Positioner.Props) {\r\n  return (\r\n    <BaseCombobox.Positioner\r\n      data-slot=\"combobox-positioner\"\r\n      sideOffset={6}\r\n      className={cn(\"\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxPopupPrimitive({\r\n  className,\r\n  ...props\r\n}: BaseCombobox.Popup.Props) {\r\n  return (\r\n    <BaseCombobox.Popup\r\n      data-slot=\"combobox-popup\"\r\n      className={cn(\r\n        \"bg-popover text-popover-foreground ring-border ease-out-cubic flex max-h-(--available-height) w-(--anchor-width) max-w-(--available-width) origin-(--transform-origin) flex-col overflow-clip overscroll-contain rounded-xl shadow-[0_8px_20px_0_oklch(0_0_0/0.08)] ring-1 transition-[transform,scale,opacity] duration-100 data-ending-style:scale-95 data-ending-style:opacity-0 data-starting-style:scale-95 data-starting-style:opacity-0\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxArrow({ className, ...props }: BaseCombobox.Arrow.Props) {\r\n  return (\r\n    <BaseCombobox.Arrow\r\n      data-slot=\"combobox-arrow\"\r\n      className={cn(\r\n        \"data-[side=bottom]:top-[-8px] data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-8px] data-[side=top]:rotate-180\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      <svg width=\"20\" height=\"10\" viewBox=\"0 0 20 10\" fill=\"none\">\r\n        <path\r\n          d=\"M9.66437 2.60207L4.80758 6.97318C4.07308 7.63423 3.11989 8 2.13172 8H0V9H20V8H18.5349C17.5468 8 16.5936 7.63423 15.8591 6.97318L11.0023 2.60207C10.622 2.2598 10.0447 2.25979 9.66437 2.60207Z\"\r\n          className=\"fill-popover\"\r\n        />\r\n        <path\r\n          d=\"M10.3333 3.34539L5.47654 7.71648C4.55842 8.54279 3.36693 9 2.13172 9H0V8H2.13172C3.11989 8 4.07308 7.63423 4.80758 6.97318L9.66437 2.60207C10.0447 2.25979 10.622 2.2598 11.0023 2.60207L15.8591 6.97318C16.5936 7.63423 17.5468 8 18.5349 8H20V9H18.5349C17.2998 9 16.1083 8.54278 15.1901 7.71648L10.3333 3.34539Z\"\r\n          className=\"fill-border/70\"\r\n        />\r\n      </svg>\r\n    </BaseCombobox.Arrow>\r\n  );\r\n}\r\n\r\nfunction ComboboxStatus({ className, ...props }: BaseCombobox.Status.Props) {\r\n  return (\r\n    <BaseCombobox.Status\r\n      data-slot=\"combobox-status\"\r\n      className={cn(\r\n        \"text-muted-foreground px-3 py-2.5 text-sm leading-5 empty:m-0 empty:p-0\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxEmpty({ className, ...props }: BaseCombobox.Empty.Props) {\r\n  return (\r\n    <BaseCombobox.Empty\r\n      data-slot=\"combobox-empty\"\r\n      className={cn(\r\n        \"text-muted-foreground px-3 py-2.5 text-sm empty:m-0 empty:p-0\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxList({\r\n  className,\r\n  nativeScroll = false,\r\n  fadeEdges = true,\r\n  scrollbarGutter = false,\r\n  persistScrollbar,\r\n  hideScrollbar,\r\n  ...props\r\n}: BaseCombobox.List.Props &\r\n  Pick<\r\n    ScrollAreaProps,\r\n    | \"nativeScroll\"\r\n    | \"fadeEdges\"\r\n    | \"scrollbarGutter\"\r\n    | \"persistScrollbar\"\r\n    | \"hideScrollbar\"\r\n  >) {\r\n  return (\r\n    <ScrollArea\r\n      nativeScroll={nativeScroll}\r\n      fadeEdges={fadeEdges}\r\n      scrollbarGutter={scrollbarGutter}\r\n      persistScrollbar={persistScrollbar}\r\n      hideScrollbar={hideScrollbar}\r\n      className={cn(\"max-h-80\", className)}\r\n    >\r\n      <BaseCombobox.List\r\n        data-slot=\"combobox-list\"\r\n        className=\"rounded-xl\"\r\n        {...props}\r\n      />\r\n    </ScrollArea>\r\n  );\r\n}\r\n\r\nfunction ComboboxCollection({ ...props }: BaseCombobox.Collection.Props) {\r\n  return <BaseCombobox.Collection data-slot=\"combobox-collection\" {...props} />;\r\n}\r\n\r\nfunction ComboboxRow({ className, ...props }: BaseCombobox.Row.Props) {\r\n  return (\r\n    <BaseCombobox.Row\r\n      data-slot=\"combobox-row\"\r\n      className={cn(\"flex\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxItem({\r\n  className,\r\n  children,\r\n  ...props\r\n}: BaseCombobox.Item.Props) {\r\n  return (\r\n    <BaseCombobox.Item\r\n      data-slot=\"combobox-item\"\r\n      className={cn(\r\n        \"data-highlighted:bg-accent/50 data-highlighted:text-accent-foreground relative grid cursor-default grid-cols-[1fr_1rem] items-center gap-2 rounded-md px-2.5 py-2 pr-2 text-sm outline-none select-none data-disabled:pointer-events-none data-disabled:opacity-60\",\r\n        // Spacing from list edges\r\n        \"mx-1 first:mt-1 last:mb-1\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    >\r\n      <div className=\"break-all\">{children}</div>\r\n      <BaseCombobox.ItemIndicator render={<CheckIcon className=\"size-4\" />} />\r\n    </BaseCombobox.Item>\r\n  );\r\n}\r\n\r\nfunction ComboboxItemIndicator({\r\n  className,\r\n  ...props\r\n}: BaseCombobox.ItemIndicator.Props) {\r\n  return (\r\n    <BaseCombobox.ItemIndicator\r\n      data-slot=\"combobox-item-indicator\"\r\n      className={cn(\"\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxGroup({ className, ...props }: BaseCombobox.Group.Props) {\r\n  return (\r\n    <BaseCombobox.Group\r\n      data-slot=\"combobox-group\"\r\n      className={cn(\"text-foreground block\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxGroupLabel({\r\n  className,\r\n  ...props\r\n}: BaseCombobox.GroupLabel.Props) {\r\n  return (\r\n    <BaseCombobox.GroupLabel\r\n      data-slot=\"combobox-group-label\"\r\n      className={cn(\r\n        \"text-muted-foreground bg-popover px-3.5 py-1.5 pt-2.5 text-xs font-semibold\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxSeparator({\r\n  className,\r\n  ...props\r\n}: BaseCombobox.Separator.Props) {\r\n  return (\r\n    <BaseCombobox.Separator\r\n      data-slot=\"combobox-separator\"\r\n      className={cn(\"bg-border mx-1 my-1 h-px min-h-px\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxChips({ className, ...props }: BaseCombobox.Chips.Props) {\r\n  const context = React.useContext(ComboboxContext);\r\n\r\n  return (\r\n    <BaseCombobox.Chips\r\n      ref={context?.chipsRef}\r\n      data-slot=\"combobox-chips\"\r\n      className={cn(\r\n        \"bg-input dark:bg-input/30 flex min-h-9 w-full flex-wrap items-center gap-1.5 rounded-lg border bg-clip-padding px-1.5 py-1.5 shadow-xs\",\r\n        \"focus-within:outline-ring/50 outline-0 outline-offset-0 outline-transparent transition-[outline-width,outline-offset,outline-color] duration-100 ease-out outline-solid focus-within:outline-2 focus-within:outline-offset-2\",\r\n\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxChip({ className, ...props }: BaseCombobox.Chip.Props) {\r\n  return (\r\n    <BaseCombobox.Chip\r\n      data-slot=\"combobox-chip\"\r\n      className={cn(\r\n        \"bg-accent text-accent-foreground dark:border-border/50 flex items-center gap-1 rounded-sm border px-[calc(--spacing(2)-1px)] py-[calc(--spacing(1)-1px)] text-sm font-medium break-all sm:text-xs\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\nfunction ComboboxChipRemove({\r\n  className,\r\n  ...props\r\n}: BaseCombobox.ChipRemove.Props) {\r\n  return (\r\n    <BaseCombobox.ChipRemove\r\n      data-slot=\"combobox-chip-remove\"\r\n      className={cn(\r\n        \"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm opacity-70 transition-opacity hover:opacity-100 disabled:pointer-events-none\",\r\n        \"focus-visible:border-ring focus-visible:ring-ring/30 cursor-pointer outline-none focus-visible:ring-3\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\ninterface ComboboxPopupProps extends BaseCombobox.Popup.Props {\r\n  sideOffset?: BaseCombobox.Positioner.Props[\"sideOffset\"];\r\n  backdrop?: boolean;\r\n}\r\n\r\nfunction ComboboxPopup({\r\n  className,\r\n  children,\r\n  sideOffset = 6,\r\n  backdrop = false,\r\n  ...props\r\n}: ComboboxPopupProps) {\r\n  const context = React.useContext(ComboboxContext);\r\n\r\n  return (\r\n    <ComboboxPortal>\r\n      {backdrop && <ComboboxBackdrop />}\r\n      <ComboboxPositioner anchor={context?.chipsRef} sideOffset={sideOffset}>\r\n        <ComboboxPopupPrimitive className={className} {...props}>\r\n          {children}\r\n        </ComboboxPopupPrimitive>\r\n      </ComboboxPositioner>\r\n    </ComboboxPortal>\r\n  );\r\n}\r\n\r\nfunction ComboboxLabel({\r\n  className,\r\n  ...props\r\n}: React.ComponentProps<typeof Label>) {\r\n  const context = React.useContext(ComboboxContext);\r\n\r\n  return <Label htmlFor={context?.id} className={className} {...props} />;\r\n}\r\n\r\nexport {\r\n  Combobox,\r\n  ComboboxInput,\r\n  ComboboxInputWrapper,\r\n  ComboboxChipInput,\r\n  ComboboxTrigger,\r\n  ComboboxIcon,\r\n  ComboboxClear,\r\n  ComboboxValue,\r\n  ComboboxPortal,\r\n  ComboboxBackdrop,\r\n  ComboboxPositioner,\r\n  ComboboxPopupPrimitive,\r\n  ComboboxPopup,\r\n  ComboboxArrow,\r\n  ComboboxStatus,\r\n  ComboboxEmpty,\r\n  ComboboxList,\r\n  ComboboxCollection,\r\n  ComboboxRow,\r\n  ComboboxItem,\r\n  ComboboxItemIndicator,\r\n  ComboboxGroup,\r\n  ComboboxGroupLabel,\r\n  ComboboxSeparator,\r\n  ComboboxChips,\r\n  ComboboxChip,\r\n  ComboboxChipRemove,\r\n  ComboboxLabel,\r\n  useFilter,\r\n};\r\n",
      "type": "registry:ui",
      "target": "components/ui/cubby-ui/combobox/combobox.tsx"
    },
    {
      "path": "registry/default/combobox/hooks/use-async-combobox.ts",
      "content": "import * as React from \"react\";\n\nexport interface UseAsyncComboboxOptions<T extends { id: string }> {\n  /**\n   * Async search function that receives the query and an AbortSignal.\n   * Should return an array of items matching the query.\n   */\n  searchFn: (query: string, signal: AbortSignal) => Promise<T[]>;\n\n  /**\n   * Debounce delay in milliseconds. Defaults to 0 (no debounce).\n   */\n  debounceMs?: number;\n}\n\nexport interface UseAsyncComboboxSingleOptions<T extends { id: string }>\n  extends UseAsyncComboboxOptions<T> {\n  /**\n   * Whether multiple selection is enabled\n   */\n  multiple?: false;\n\n  /**\n   * Controlled selected value\n   */\n  value?: T | null;\n\n  /**\n   * Callback when value changes\n   */\n  onValueChange?: (value: T | null) => void;\n}\n\nexport interface UseAsyncComboboxMultipleOptions<T extends { id: string }>\n  extends UseAsyncComboboxOptions<T> {\n  /**\n   * Whether multiple selection is enabled\n   */\n  multiple: true;\n\n  /**\n   * Controlled selected values\n   */\n  value?: T[];\n\n  /**\n   * Callback when values change\n   */\n  onValueChange?: (value: T[]) => void;\n}\n\nexport interface UseAsyncComboboxReturn<T extends { id: string }> {\n  /**\n   * Items array with search results merged with selected values.\n   * Selected values are always kept in the list during search.\n   */\n  items: T[];\n\n  /**\n   * Props to spread onto the Combobox component\n   */\n  comboboxProps: {\n    inputValue: string;\n    onInputValueChange: (\n      value: string,\n      details: { reason: string; event: Event | React.SyntheticEvent },\n    ) => void;\n    filter: null;\n    onOpenChangeComplete: (open: boolean) => void;\n  };\n\n  /**\n   * Whether a search is in progress\n   */\n  isPending: boolean;\n\n  /**\n   * Error message if the search failed\n   */\n  error: string | null;\n\n  /**\n   * Trimmed input value for status message logic\n   */\n  query: string;\n}\n\n/**\n * Hook to manage async search combobox state and logic\n *\n * This hook encapsulates the complex logic needed for async search:\n * - AbortController for canceling in-flight requests\n * - useTransition for pending states\n * - Merging search results with selected values to keep them visible\n * - Clearing results when popup closes\n *\n * @example\n * ```tsx\n * const [value, setValue] = useState<Employee | null>(null);\n *\n * const { items, comboboxProps, isPending, error, query } = useAsyncCombobox({\n *   searchFn: searchEmployees,\n *   value,\n *   onValueChange: setValue,\n * });\n *\n * <Combobox items={items} value={value} onValueChange={setValue} {...comboboxProps}>\n *   ...\n * </Combobox>\n * ```\n */\nexport function useAsyncCombobox<T extends { id: string }>(\n  options: UseAsyncComboboxSingleOptions<T>,\n): UseAsyncComboboxReturn<T>;\nexport function useAsyncCombobox<T extends { id: string }>(\n  options: UseAsyncComboboxMultipleOptions<T>,\n): UseAsyncComboboxReturn<T>;\nexport function useAsyncCombobox<T extends { id: string }>({\n  searchFn,\n  debounceMs = 0,\n  multiple,\n  value,\n  onValueChange,\n}:\n  | UseAsyncComboboxSingleOptions<T>\n  | UseAsyncComboboxMultipleOptions<T>): UseAsyncComboboxReturn<T> {\n  const [searchResults, setSearchResults] = React.useState<T[]>([]);\n  const [inputValue, setInputValue] = React.useState(\"\");\n  const [error, setError] = React.useState<string | null>(null);\n  const [isPending, startTransition] = React.useTransition();\n\n  const abortControllerRef = React.useRef<AbortController | null>(null);\n  const debounceTimerRef = React.useRef<ReturnType<typeof setTimeout> | null>(\n    null,\n  );\n\n  const query = inputValue.trim();\n\n  // Merge search results with selected values to keep them visible\n  const items = React.useMemo(() => {\n    if (multiple) {\n      const selectedValues = (value as T[] | undefined) ?? [];\n      if (selectedValues.length === 0) {\n        return searchResults;\n      }\n      // Add selected values that aren't already in search results\n      const searchIds = new Set(searchResults.map((item) => item.id));\n      const missingSelected = selectedValues.filter(\n        (item) => !searchIds.has(item.id),\n      );\n      return [...searchResults, ...missingSelected];\n    } else {\n      const selectedValue = value as T | null | undefined;\n      if (\n        !selectedValue ||\n        searchResults.some((item) => item.id === selectedValue.id)\n      ) {\n        return searchResults;\n      }\n      return [...searchResults, selectedValue];\n    }\n  }, [searchResults, value, multiple]);\n\n  // Perform search\n  const performSearch = React.useCallback(\n    (searchQuery: string) => {\n      // Cancel any previous request\n      abortControllerRef.current?.abort();\n      const controller = new AbortController();\n      abortControllerRef.current = controller;\n\n      startTransition(async () => {\n        setError(null);\n\n        try {\n          const results = await searchFn(searchQuery, controller.signal);\n\n          if (controller.signal.aborted) {\n            return;\n          }\n\n          startTransition(() => {\n            setSearchResults(results);\n          });\n        } catch (err) {\n          if (controller.signal.aborted) {\n            return;\n          }\n\n          const message =\n            err instanceof Error ? err.message : \"Search failed. Try again.\";\n          setError(message);\n          setSearchResults([]);\n        }\n      });\n    },\n    [searchFn],\n  );\n\n  // Handle input value changes\n  const handleInputValueChange = React.useCallback(\n    (\n      nextValue: string,\n      details: { reason: string; event: Event | React.SyntheticEvent },\n    ) => {\n      setInputValue(nextValue);\n\n      // Don't search if input was cleared due to item selection\n      if (details.reason === \"item-press\") {\n        return;\n      }\n\n      // Clear debounce timer\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n        debounceTimerRef.current = null;\n      }\n\n      const trimmed = nextValue.trim();\n\n      if (trimmed === \"\") {\n        setSearchResults([]);\n        setError(null);\n        abortControllerRef.current?.abort();\n        return;\n      }\n\n      // Debounce the search\n      if (debounceMs > 0) {\n        debounceTimerRef.current = setTimeout(() => {\n          performSearch(trimmed);\n        }, debounceMs);\n      } else {\n        performSearch(trimmed);\n      }\n    },\n    [debounceMs, performSearch],\n  );\n\n  // Handle popup close - reset to only show selected values\n  const handleOpenChangeComplete = React.useCallback(\n    (open: boolean) => {\n      if (!open) {\n        if (multiple) {\n          const selectedValues = (value as T[] | undefined) ?? [];\n          setSearchResults(selectedValues);\n          // Clear input for multiple selection (chips show the selections)\n          setInputValue(\"\");\n        } else {\n          const selectedValue = value as T | null | undefined;\n          setSearchResults(selectedValue ? [selectedValue] : []);\n          // Don't clear input for single selection - Base UI handles\n          // displaying the selected value via itemToStringLabel\n        }\n        setError(null);\n      }\n    },\n    [value, multiple],\n  );\n\n  // Cleanup on unmount\n  React.useEffect(() => {\n    return () => {\n      abortControllerRef.current?.abort();\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    items,\n    comboboxProps: {\n      inputValue,\n      onInputValueChange: handleInputValueChange,\n      filter: null,\n      onOpenChangeComplete: handleOpenChangeComplete,\n    },\n    isPending,\n    error,\n    query,\n  };\n}\n",
      "type": "registry:hook",
      "target": "components/ui/cubby-ui/combobox/hooks/use-async-combobox.ts"
    },
    {
      "path": "registry/default/combobox/hooks/use-creatable-combobox.ts",
      "content": "import * as React from \"react\";\n\nexport interface UseCreatableComboboxOptions<\n  T extends { id: string; value: string },\n> {\n  /**\n   * Controlled items for the combobox\n   */\n  items: T[];\n\n  /**\n   * Callback when items change\n   */\n  onItemsChange: (items: T[]) => void;\n\n  /**\n   * Controlled selected items\n   */\n  selectedItems: T[];\n\n  /**\n   * Callback when selected items change\n   */\n  onSelectedItemsChange: (items: T[]) => void;\n}\n\nexport interface UseCreatableComboboxReturn<\n  T extends { id: string; value: string },\n> {\n  /**\n   * Items array with pseudo \"Create X\" item injected when applicable\n   */\n  itemsWithCreatable: Array<T & { creatable?: string }>;\n\n  /**\n   * Props to spread onto the Combobox component\n   */\n  comboboxProps: {\n    value: T[];\n    onValueChange: (value: unknown) => void;\n    inputValue: string;\n    onInputValueChange: (value: string) => void;\n    onOpenChange: (\n      open: boolean,\n      details: { event: Event | React.SyntheticEvent },\n    ) => void;\n  };\n\n  /**\n   * Props to spread onto the Dialog component\n   */\n  dialogProps: {\n    open: boolean;\n    onOpenChange: (open: boolean) => void;\n  };\n\n  /**\n   * Props to spread onto the dialog input element\n   */\n  dialogInputProps: {\n    ref: React.RefObject<HTMLInputElement | null>;\n    defaultValue: string;\n  };\n\n  /**\n   * Form submit handler (handles preventDefault internally)\n   */\n  onDialogSubmit: (event: React.FormEvent<HTMLFormElement>) => void;\n\n  /**\n   * Dialog cancel handler\n   */\n  handleCancel: () => void;\n}\n\n/**\n * Slugify a string to create a valid ID\n */\nfunction slugify(value: string): string {\n  return value\n    .trim()\n    .toLowerCase()\n    .replace(/\\s+/g, \"-\")\n    .replace(/[^\\w-]/g, \"\");\n}\n\n/**\n * Generate a unique ID from a value, handling collisions\n */\nfunction generateUniqueId<T extends { id: string }>(\n  value: string,\n  existingItems: T[],\n): string {\n  const baseId = slugify(value);\n  const existingIds = new Set(existingItems.map((item) => item.id));\n\n  let uniqueId = baseId;\n  if (existingIds.has(uniqueId)) {\n    let counter = 2;\n    while (existingIds.has(`${baseId}-${counter}`)) {\n      counter += 1;\n    }\n    uniqueId = `${baseId}-${counter}`;\n  }\n\n  return uniqueId;\n}\n\n/**\n * Hook to manage creatable combobox state and logic\n *\n * This hook encapsulates all the complex logic needed for a creatable combobox:\n * - Injecting a pseudo \"Create X\" item when the query doesn't match existing items\n * - Handling item creation via a confirmation dialog with automatic ID generation\n * - Normalizing values and checking for duplicates\n *\n * @example\n * ```tsx\n * const [items, setItems] = useState(initialLabels);\n * const [selectedItems, setSelectedItems] = useState<LabelItem[]>([]);\n *\n * const { itemsWithCreatable, comboboxProps, dialogProps, dialogInputProps, onDialogSubmit, handleCancel } =\n *   useCreatableCombobox({\n *     items,\n *     onItemsChange: setItems,\n *     selectedItems,\n *     onSelectedItemsChange: setSelectedItems,\n *   });\n * ```\n */\nexport function useCreatableCombobox<T extends { id: string; value: string }>({\n  items,\n  onItemsChange,\n  selectedItems,\n  onSelectedItemsChange,\n}: UseCreatableComboboxOptions<T>): UseCreatableComboboxReturn<T> {\n  const [query, setQuery] = React.useState(\"\");\n  const [dialogOpen, setDialogOpen] = React.useState(false);\n  const [pendingValue, setPendingValue] = React.useState(\"\");\n\n  const inputRef = React.useRef<HTMLInputElement>(null);\n\n  // Helper to normalize values for comparison\n  const normalize = React.useCallback((value: string) => {\n    return value.trim().toLowerCase();\n  }, []);\n\n  // Helper to check if an item already exists\n  const itemExists = React.useCallback(\n    (value: string) => {\n      const normalized = normalize(value);\n      return items.some((item) => normalize(item.value) === normalized);\n    },\n    [items, normalize],\n  );\n\n  // Create the items array with pseudo \"Create X\" item if needed\n  const itemsWithCreatable = React.useMemo(() => {\n    const trimmed = query.trim();\n    if (!trimmed || itemExists(trimmed)) {\n      return items;\n    }\n\n    // Add pseudo item\n    const normalized = normalize(trimmed);\n    return [\n      ...items,\n      {\n        id: `create:${normalized}`,\n        value: `Create \"${trimmed}\"`,\n        creatable: trimmed,\n      } as T & { creatable: string },\n    ];\n  }, [items, query, itemExists, normalize]);\n\n  // Handle item creation\n  const handleCreate = React.useCallback(() => {\n    const value = pendingValue.trim();\n    if (!value) return;\n\n    // Check if item already exists\n    if (itemExists(value)) {\n      const existing = items.find(\n        (item) => normalize(item.value) === normalize(value),\n      );\n      if (\n        existing &&\n        !selectedItems.some((item) => item.id === existing.id)\n      ) {\n        onSelectedItemsChange([...selectedItems, existing]);\n      }\n      setDialogOpen(false);\n      setQuery(\"\");\n      setPendingValue(\"\");\n      return;\n    }\n\n    // Create new item with auto-generated ID\n    const id = generateUniqueId(value, items);\n    const newItem = { id, value } as T;\n\n    onItemsChange([...items, newItem]);\n    onSelectedItemsChange([...selectedItems, newItem]);\n    setDialogOpen(false);\n    setQuery(\"\");\n    setPendingValue(\"\");\n  }, [\n    pendingValue,\n    items,\n    selectedItems,\n    onItemsChange,\n    onSelectedItemsChange,\n    itemExists,\n    normalize,\n  ]);\n\n  // Handle value change from combobox\n  const handleValueChange = React.useCallback(\n    (value: unknown) => {\n      const valueArray = Array.isArray(value) ? value : value ? [value] : [];\n      const last = valueArray[valueArray.length - 1];\n\n      // Check if the last selected item is the pseudo \"Create X\" item\n      if (last && \"creatable\" in last && last.creatable) {\n        setPendingValue(last.creatable);\n        setDialogOpen(true);\n        return;\n      }\n\n      // Filter out any pseudo items and update selected\n      const cleanValue = valueArray.filter(\n        (item) => !(\"creatable\" in item && item.creatable),\n      );\n      onSelectedItemsChange(cleanValue as T[]);\n      setQuery(\"\");\n    },\n    [onSelectedItemsChange],\n  );\n\n  // Handle combobox open/close - intercept Enter key to open dialog\n  const handleOpenChange = React.useCallback(\n    (\n      open: boolean,\n      details: { event: Event | React.SyntheticEvent },\n    ) => {\n      // Check if Enter key was pressed with a query that doesn't match\n      if (\n        \"key\" in details.event &&\n        (details.event as KeyboardEvent).key === \"Enter\"\n      ) {\n        const trimmed = query.trim();\n        if (!trimmed) return;\n\n        // Check if item exists\n        if (itemExists(trimmed)) {\n          const existing = items.find(\n            (item) => normalize(item.value) === normalize(trimmed),\n          );\n          if (\n            existing &&\n            !selectedItems.some((item) => item.id === existing.id)\n          ) {\n            onSelectedItemsChange([...selectedItems, existing]);\n          }\n          setQuery(\"\");\n          return;\n        }\n\n        // Open dialog for new item creation\n        setPendingValue(trimmed);\n        setDialogOpen(true);\n      }\n    },\n    [query, items, selectedItems, itemExists, normalize, onSelectedItemsChange],\n  );\n\n  // Dialog submit handler\n  const onDialogSubmit = React.useCallback(\n    (event: React.FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      handleCreate();\n    },\n    [handleCreate],\n  );\n\n  // Dialog cancel handler\n  const handleCancel = React.useCallback(() => {\n    setDialogOpen(false);\n    setPendingValue(\"\");\n  }, []);\n\n  return {\n    itemsWithCreatable,\n    comboboxProps: {\n      value: selectedItems,\n      onValueChange: handleValueChange,\n      inputValue: query,\n      onInputValueChange: setQuery,\n      onOpenChange: handleOpenChange,\n    },\n    dialogProps: {\n      open: dialogOpen,\n      onOpenChange: setDialogOpen,\n    },\n    dialogInputProps: {\n      ref: inputRef,\n      defaultValue: pendingValue,\n    },\n    onDialogSubmit,\n    handleCancel,\n  };\n}\n",
      "type": "registry:hook",
      "target": "components/ui/cubby-ui/combobox/hooks/use-creatable-combobox.ts"
    }
  ]
}