{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "combobox",
  "type": "registry:ui",
  "title": "Combobox",
  "description": "A combobox component.",
  "dependencies": [
    "lucide-react"
  ],
  "registryDependencies": [
    "@cubby-ui/label"
  ],
  "files": [
    {
      "path": "registry/default/combobox/combobox.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\n// import * as ComboboxPrimitive from \"@base-ui-components/react/combobox\";\nimport { cn } from \"@/lib/utils\";\nimport { X, CheckIcon, ChevronDown } from \"lucide-react\";\nimport { Label } from \"@/registry/default/label/label\";\nimport { Combobox as BaseCombobox } from \"@base-ui-components/react/combobox\";\n\nconst useFilter = BaseCombobox.useFilter;\n\nconst ComboboxContext = React.createContext<{\n  id: string;\n  chipsRef: React.RefObject<HTMLDivElement | null>;\n} | null>(null);\n\nfunction Combobox<Value, Multiple extends boolean | undefined = false>(\n  props: BaseCombobox.Root.Props<Value, Multiple>,\n): React.JSX.Element {\n  const id = React.useId();\n  const chipsRef = React.useRef<HTMLDivElement | null>(null);\n\n  const contextValue = React.useMemo(() => ({ id, chipsRef }), [id]);\n\n  return (\n    <ComboboxContext.Provider value={contextValue}>\n      <BaseCombobox.Root data-slot=\"combobox\" {...props} />\n    </ComboboxContext.Provider>\n  );\n}\n\nfunction ComboboxInput({\n  id: idProp,\n  className,\n  ...props\n}: BaseCombobox.Input.Props) {\n  const context = React.useContext(ComboboxContext);\n  const id = idProp ?? context?.id;\n\n  return (\n    <BaseCombobox.Input\n      id={id}\n      data-slot=\"combobox-input\"\n      className={cn(\n        \"placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground bg-input dark:bg-input/30 border-border py- flex h-10 w-full min-w-0 rounded-lg border px-3 text-base font-normal shadow-[0_1px_2px_0_oklch(0.18_0_0_/_0.03)] disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-60 sm:h-9 md:text-sm\",\n        \"file:text-foreground file:inline-flex file:h-7 file:rounded-md file:border-0 file:bg-transparent file:text-sm file:font-medium\",\n        \"focus-visible:outline-ring/50 outline-0 outline-offset-0 outline-transparent transition-[outline-width,outline-offset,outline-color] duration-100 ease-out outline-solid focus-visible:outline-2 focus-visible:outline-offset-2\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxInputWrapper({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"combobox-input-wrapper\"\n      className={cn(\n        \"relative\",\n        // Auto-adjust input padding based on buttons present (right-3 = 0.75rem, button = 1rem)\n        \"has-[[data-slot=combobox-clear]]:[&_[data-slot=combobox-input]]:pr-[1.75rem]\",\n        \"has-[[data-slot=combobox-trigger]]:[&_[data-slot=combobox-input]]:pr-[1.75rem]\",\n        // Both buttons present (0.75rem + 1rem + 0.5rem gap + 1rem button = 3.25rem)\n        \"has-[[data-slot=combobox-clear]]:has-[[data-slot=combobox-trigger]]:[&_[data-slot=combobox-input]]:pr-[3.25rem]\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxChipInput({\n  id: idProp,\n  className,\n  ...props\n}: BaseCombobox.Input.Props) {\n  const context = React.useContext(ComboboxContext);\n  const id = idProp ?? context?.id;\n\n  return (\n    <BaseCombobox.Input\n      id={id}\n      data-slot=\"combobox-input\"\n      className={cn(\n        \"placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground h-7 min-w-12 flex-1 rounded-none border-none bg-transparent p-0 pl-1.5 text-base font-normal shadow-none outline-none focus-visible:ring-0 focus-visible:ring-offset-0 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-60 sm:h-6 md:text-sm\",\n\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxTrigger({ className, ...props }: BaseCombobox.Trigger.Props) {\n  return (\n    <BaseCombobox.Trigger\n      data-slot=\"combobox-trigger\"\n      aria-label=\"Open popup\"\n      className={cn(\n        \"inline-flex size-4 cursor-pointer items-center justify-center rounded-md border-none bg-transparent p-0 text-sm font-medium transition-colors disabled:pointer-events-none disabled:opacity-60\",\n        \"focus-visible:border-ring focus-visible:ring-ring/30 focus-visible:ring-3\",\n\n        className,\n      )}\n      {...props}\n    >\n      <ChevronDown className=\"h-4 w-4\" />\n    </BaseCombobox.Trigger>\n  );\n}\n\nfunction ComboboxIcon({ className, ...props }: BaseCombobox.Icon.Props) {\n  return (\n    <BaseCombobox.Icon\n      data-slot=\"combobox-icon\"\n      className={cn(\"ml-2 h-4 w-4 shrink-0 opacity-50\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxClear({ className, ...props }: BaseCombobox.Clear.Props) {\n  return (\n    <BaseCombobox.Clear\n      data-slot=\"combobox-clear\"\n      aria-label=\"Clear selection\"\n      className={cn(\n        \"inline-flex h-4 w-4 cursor-pointer items-center justify-center rounded-sm opacity-70 transition-[opacity,scale,transform,translate] hover:opacity-100 disabled:pointer-events-none\",\n        \"focus-visible:border-ring focus-visible:ring-ring/30 duration-100 outline-none focus-visible:ring-3\",\n        \"data-[ending-style]:translate-x-1 data-[ending-style]:opacity-0 data-[starting-style]:translate-x-1 data-[starting-style]:opacity-0\",\n        className,\n      )}\n      {...props}\n    >\n      <X className=\"h-4 w-4\" />\n    </BaseCombobox.Clear>\n  );\n}\n\nfunction ComboboxValue({ ...props }: BaseCombobox.Value.Props) {\n  return <BaseCombobox.Value data-slot=\"combobox-value\" {...props} />;\n}\n\nfunction ComboboxPortal({ ...props }: BaseCombobox.Portal.Props) {\n  return <BaseCombobox.Portal data-slot=\"combobox-portal\" {...props} />;\n}\n\nfunction ComboboxBackdrop({\n  className,\n  ...props\n}: BaseCombobox.Backdrop.Props) {\n  return (\n    <BaseCombobox.Backdrop\n      data-slot=\"combobox-backdrop\"\n      className={cn(\n        \"fixed inset-0 z-30 bg-black/50 data-[ending-style]:opacity-0 data-[starting-style]:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxPositioner({\n  className,\n  ...props\n}: BaseCombobox.Positioner.Props) {\n  return (\n    <BaseCombobox.Positioner\n      data-slot=\"combobox-positioner\"\n      sideOffset={6}\n      className={cn(\"\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxPopupPrimitive({\n  className,\n  ...props\n}: BaseCombobox.Popup.Props) {\n  return (\n    <BaseCombobox.Popup\n      data-slot=\"combobox-popup\"\n      className={cn(\n        \"bg-popover text-popover-foreground outline-border/70 ring-border/50 dark:ring-border ease-out-cubic max-h-[min(var(--available-height),20rem)] w-[var(--anchor-width)] max-w-[var(--available-width)] origin-[var(--transform-origin)] overflow-y-auto overscroll-contain rounded-xl p-1 shadow-[0_8px_20px_0_oklch(0.18_0_0_/_0.10)] ring-1 transition-[transform,scale,opacity] duration-100 data-[ending-style]:scale-95 data-[ending-style]:opacity-0 data-[starting-style]:scale-95 data-[starting-style]:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxArrow({ className, ...props }: BaseCombobox.Arrow.Props) {\n  return (\n    <BaseCombobox.Arrow\n      data-slot=\"combobox-arrow\"\n      className={cn(\n        \"data-[side=bottom]:top-[-8px] data-[side=left]:right-[-13px] data-[side=left]:rotate-90 data-[side=right]:left-[-13px] data-[side=right]:-rotate-90 data-[side=top]:bottom-[-8px] data-[side=top]:rotate-180\",\n        className,\n      )}\n      {...props}\n    >\n      <svg width=\"20\" height=\"10\" viewBox=\"0 0 20 10\" fill=\"none\">\n        <path\n          d=\"M9.66437 2.60207L4.80758 6.97318C4.07308 7.63423 3.11989 8 2.13172 8H0V9H20V8H18.5349C17.5468 8 16.5936 7.63423 15.8591 6.97318L11.0023 2.60207C10.622 2.2598 10.0447 2.25979 9.66437 2.60207Z\"\n          className=\"fill-popover\"\n        />\n        <path\n          d=\"M10.3333 3.34539L5.47654 7.71648C4.55842 8.54279 3.36693 9 2.13172 9H0V8H2.13172C3.11989 8 4.07308 7.63423 4.80758 6.97318L9.66437 2.60207C10.0447 2.25979 10.622 2.2598 11.0023 2.60207L15.8591 6.97318C16.5936 7.63423 17.5468 8 18.5349 8H20V9H18.5349C17.2998 9 16.1083 8.54278 15.1901 7.71648L10.3333 3.34539Z\"\n          className=\"fill-border/70\"\n        />\n      </svg>\n    </BaseCombobox.Arrow>\n  );\n}\n\nfunction ComboboxStatus({ className, ...props }: BaseCombobox.Status.Props) {\n  return (\n    <BaseCombobox.Status\n      data-slot=\"combobox-status\"\n      className={cn(\n        \"text-muted-foreground px-2 py-1.5 text-sm leading-5 empty:m-0 empty:p-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxEmpty({ className, ...props }: BaseCombobox.Empty.Props) {\n  return (\n    <BaseCombobox.Empty\n      data-slot=\"combobox-empty\"\n      className={cn(\n        \"text-muted-foreground px-2 py-1.5 text-sm empty:m-0 empty:p-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxList({ className, ...props }: BaseCombobox.List.Props) {\n  return (\n    <BaseCombobox.List\n      data-slot=\"combobox-list\"\n      className={cn(\"\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxCollection({ ...props }: BaseCombobox.Collection.Props) {\n  return <BaseCombobox.Collection data-slot=\"combobox-collection\" {...props} />;\n}\n\nfunction ComboboxRow({ className, ...props }: BaseCombobox.Row.Props) {\n  return (\n    <BaseCombobox.Row\n      data-slot=\"combobox-row\"\n      className={cn(\"flex\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxItem({\n  className,\n  children,\n  ...props\n}: BaseCombobox.Item.Props) {\n  return (\n    <BaseCombobox.Item\n      data-slot=\"combobox-item\"\n      className={cn(\n        \"data-[highlighted]:bg-accent/50 data-[highlighted]:text-accent-foreground relative grid cursor-default grid-cols-[1fr_1rem] items-center gap-2 rounded-md px-2.5 py-2 pr-2 text-sm outline-none select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-60\",\n        className,\n      )}\n      {...props}\n    >\n      <div className=\"break-all\">{children}</div>\n      <BaseCombobox.ItemIndicator render={<CheckIcon className=\"size-4\" />} />\n    </BaseCombobox.Item>\n  );\n}\n\nfunction ComboboxItemIndicator({\n  className,\n  ...props\n}: BaseCombobox.ItemIndicator.Props) {\n  return (\n    <BaseCombobox.ItemIndicator\n      data-slot=\"combobox-item-indicator\"\n      className={cn(\"\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxGroup({ className, ...props }: BaseCombobox.Group.Props) {\n  return (\n    <BaseCombobox.Group\n      data-slot=\"combobox-group\"\n      className={cn(\"text-foreground block\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxGroupLabel({\n  className,\n  ...props\n}: BaseCombobox.GroupLabel.Props) {\n  return (\n    <BaseCombobox.GroupLabel\n      data-slot=\"combobox-group-label\"\n      className={cn(\n        \"text-muted-foreground bg-popover -mx-1 px-2 py-1.5 pt-2.5 pl-3.5 text-xs font-semibold\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxSeparator({\n  className,\n  ...props\n}: BaseCombobox.Separator.Props) {\n  return (\n    <BaseCombobox.Separator\n      data-slot=\"combobox-separator\"\n      className={cn(\"bg-border my-1 h-px\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxChips({ className, ...props }: BaseCombobox.Chips.Props) {\n  const context = React.useContext(ComboboxContext);\n\n  return (\n    <BaseCombobox.Chips\n      ref={context?.chipsRef}\n      data-slot=\"combobox-chips\"\n      className={cn(\n        \"bg-input dark:bg-input/30 flex min-h-9 w-full flex-wrap items-center gap-1.5 rounded-lg border px-1.5 py-1.5 shadow-[0_1px_2px_0_oklch(0.18_0_0_/_0.03)]\",\n        \"focus-within:outline-ring/50 outline-0 outline-offset-0 outline-transparent transition-[outline-width,outline-offset,outline-color] duration-100 ease-out outline-solid focus-within:outline-2 focus-within:outline-offset-2\",\n\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxChip({ className, ...props }: BaseCombobox.Chip.Props) {\n  return (\n    <BaseCombobox.Chip\n      data-slot=\"combobox-chip\"\n      className={cn(\n        \"bg-accent text-accent-foreground flex items-center gap-1 rounded-sm border px-[calc(--spacing(2)-1px)] py-[calc(--spacing(1)-1px)] text-sm font-medium break-all sm:text-xs\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction ComboboxChipRemove({\n  className,\n  ...props\n}: BaseCombobox.ChipRemove.Props) {\n  return (\n    <BaseCombobox.ChipRemove\n      data-slot=\"combobox-chip-remove\"\n      className={cn(\n        \"ml-1 inline-flex h-4 w-4 items-center justify-center rounded-sm opacity-70 transition-opacity hover:opacity-100 disabled:pointer-events-none\",\n        \"focus-visible:border-ring focus-visible:ring-ring/30 cursor-pointer outline-none focus-visible:ring-3\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\ninterface ComboboxPopupProps extends BaseCombobox.Popup.Props {\n  sideOffset?: BaseCombobox.Positioner.Props[\"sideOffset\"];\n  backdrop?: boolean;\n}\n\nfunction ComboboxPopup({\n  className,\n  children,\n  sideOffset = 6,\n  backdrop = false,\n  ...props\n}: ComboboxPopupProps) {\n  const context = React.useContext(ComboboxContext);\n\n  return (\n    <ComboboxPortal>\n      {backdrop && <ComboboxBackdrop />}\n      <ComboboxPositioner anchor={context?.chipsRef} sideOffset={sideOffset}>\n        <ComboboxPopupPrimitive className={className} {...props}>\n          {children}\n        </ComboboxPopupPrimitive>\n      </ComboboxPositioner>\n    </ComboboxPortal>\n  );\n}\n\nfunction ComboboxLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  const context = React.useContext(ComboboxContext);\n\n  return <Label htmlFor={context?.id} className={className} {...props} />;\n}\n\nexport {\n  Combobox,\n  ComboboxInput,\n  ComboboxInputWrapper,\n  ComboboxChipInput,\n  ComboboxTrigger,\n  ComboboxIcon,\n  ComboboxClear,\n  ComboboxValue,\n  ComboboxPortal,\n  ComboboxBackdrop,\n  ComboboxPositioner,\n  ComboboxPopupPrimitive,\n  ComboboxPopup,\n  ComboboxArrow,\n  ComboboxStatus,\n  ComboboxEmpty,\n  ComboboxList,\n  ComboboxCollection,\n  ComboboxRow,\n  ComboboxItem,\n  ComboboxItemIndicator,\n  ComboboxGroup,\n  ComboboxGroupLabel,\n  ComboboxSeparator,\n  ComboboxChips,\n  ComboboxChip,\n  ComboboxChipRemove,\n  ComboboxLabel,\n  useFilter,\n};\n",
      "type": "registry:ui",
      "target": "components/ui/cubby-ui/combobox.tsx"
    },
    {
      "path": "registry/default/combobox/hooks/use-async-combobox.ts",
      "content": "import * as React from \"react\";\n\nexport interface UseAsyncComboboxOptions<T extends { id: string }> {\n  /**\n   * Async search function that receives the query and an AbortSignal.\n   * Should return an array of items matching the query.\n   */\n  searchFn: (query: string, signal: AbortSignal) => Promise<T[]>;\n\n  /**\n   * Debounce delay in milliseconds. Defaults to 0 (no debounce).\n   */\n  debounceMs?: number;\n}\n\nexport interface UseAsyncComboboxSingleOptions<T extends { id: string }>\n  extends UseAsyncComboboxOptions<T> {\n  /**\n   * Whether multiple selection is enabled\n   */\n  multiple?: false;\n\n  /**\n   * Controlled selected value\n   */\n  value?: T | null;\n\n  /**\n   * Callback when value changes\n   */\n  onValueChange?: (value: T | null) => void;\n}\n\nexport interface UseAsyncComboboxMultipleOptions<T extends { id: string }>\n  extends UseAsyncComboboxOptions<T> {\n  /**\n   * Whether multiple selection is enabled\n   */\n  multiple: true;\n\n  /**\n   * Controlled selected values\n   */\n  value?: T[];\n\n  /**\n   * Callback when values change\n   */\n  onValueChange?: (value: T[]) => void;\n}\n\nexport interface UseAsyncComboboxReturn<T extends { id: string }> {\n  /**\n   * Items array with search results merged with selected values.\n   * Selected values are always kept in the list during search.\n   */\n  items: T[];\n\n  /**\n   * Props to spread onto the Combobox component\n   */\n  comboboxProps: {\n    inputValue: string;\n    onInputValueChange: (\n      value: string,\n      details: { reason: string; event: Event | React.SyntheticEvent },\n    ) => void;\n    filter: null;\n    onOpenChangeComplete: (open: boolean) => void;\n  };\n\n  /**\n   * Whether a search is in progress\n   */\n  isPending: boolean;\n\n  /**\n   * Error message if the search failed\n   */\n  error: string | null;\n\n  /**\n   * Trimmed input value for status message logic\n   */\n  query: string;\n}\n\n/**\n * Hook to manage async search combobox state and logic\n *\n * This hook encapsulates the complex logic needed for async search:\n * - AbortController for canceling in-flight requests\n * - useTransition for pending states\n * - Merging search results with selected values to keep them visible\n * - Clearing results when popup closes\n *\n * @example\n * ```tsx\n * const [value, setValue] = useState<Employee | null>(null);\n *\n * const { items, comboboxProps, isPending, error, query } = useAsyncCombobox({\n *   searchFn: searchEmployees,\n *   value,\n *   onValueChange: setValue,\n * });\n *\n * <Combobox items={items} value={value} onValueChange={setValue} {...comboboxProps}>\n *   ...\n * </Combobox>\n * ```\n */\nexport function useAsyncCombobox<T extends { id: string }>(\n  options: UseAsyncComboboxSingleOptions<T>,\n): UseAsyncComboboxReturn<T>;\nexport function useAsyncCombobox<T extends { id: string }>(\n  options: UseAsyncComboboxMultipleOptions<T>,\n): UseAsyncComboboxReturn<T>;\nexport function useAsyncCombobox<T extends { id: string }>({\n  searchFn,\n  debounceMs = 0,\n  multiple,\n  value,\n  onValueChange,\n}:\n  | UseAsyncComboboxSingleOptions<T>\n  | UseAsyncComboboxMultipleOptions<T>): UseAsyncComboboxReturn<T> {\n  const [searchResults, setSearchResults] = React.useState<T[]>([]);\n  const [inputValue, setInputValue] = React.useState(\"\");\n  const [error, setError] = React.useState<string | null>(null);\n  const [isPending, startTransition] = React.useTransition();\n\n  const abortControllerRef = React.useRef<AbortController | null>(null);\n  const debounceTimerRef = React.useRef<ReturnType<typeof setTimeout> | null>(\n    null,\n  );\n\n  const query = inputValue.trim();\n\n  // Merge search results with selected values to keep them visible\n  const items = React.useMemo(() => {\n    if (multiple) {\n      const selectedValues = (value as T[] | undefined) ?? [];\n      if (selectedValues.length === 0) {\n        return searchResults;\n      }\n      // Add selected values that aren't already in search results\n      const searchIds = new Set(searchResults.map((item) => item.id));\n      const missingSelected = selectedValues.filter(\n        (item) => !searchIds.has(item.id),\n      );\n      return [...searchResults, ...missingSelected];\n    } else {\n      const selectedValue = value as T | null | undefined;\n      if (\n        !selectedValue ||\n        searchResults.some((item) => item.id === selectedValue.id)\n      ) {\n        return searchResults;\n      }\n      return [...searchResults, selectedValue];\n    }\n  }, [searchResults, value, multiple]);\n\n  // Perform search\n  const performSearch = React.useCallback(\n    (searchQuery: string) => {\n      // Cancel any previous request\n      abortControllerRef.current?.abort();\n      const controller = new AbortController();\n      abortControllerRef.current = controller;\n\n      startTransition(async () => {\n        setError(null);\n\n        try {\n          const results = await searchFn(searchQuery, controller.signal);\n\n          if (controller.signal.aborted) {\n            return;\n          }\n\n          startTransition(() => {\n            setSearchResults(results);\n          });\n        } catch (err) {\n          if (controller.signal.aborted) {\n            return;\n          }\n\n          const message =\n            err instanceof Error ? err.message : \"Search failed. Try again.\";\n          setError(message);\n          setSearchResults([]);\n        }\n      });\n    },\n    [searchFn],\n  );\n\n  // Handle input value changes\n  const handleInputValueChange = React.useCallback(\n    (\n      nextValue: string,\n      details: { reason: string; event: Event | React.SyntheticEvent },\n    ) => {\n      setInputValue(nextValue);\n\n      // Don't search if input was cleared due to item selection\n      if (details.reason === \"item-press\") {\n        return;\n      }\n\n      // Clear debounce timer\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n        debounceTimerRef.current = null;\n      }\n\n      const trimmed = nextValue.trim();\n\n      if (trimmed === \"\") {\n        setSearchResults([]);\n        setError(null);\n        abortControllerRef.current?.abort();\n        return;\n      }\n\n      // Debounce the search\n      if (debounceMs > 0) {\n        debounceTimerRef.current = setTimeout(() => {\n          performSearch(trimmed);\n        }, debounceMs);\n      } else {\n        performSearch(trimmed);\n      }\n    },\n    [debounceMs, performSearch],\n  );\n\n  // Handle popup close - reset to only show selected values\n  const handleOpenChangeComplete = React.useCallback(\n    (open: boolean) => {\n      if (!open) {\n        if (multiple) {\n          const selectedValues = (value as T[] | undefined) ?? [];\n          setSearchResults(selectedValues);\n          // Clear input for multiple selection (chips show the selections)\n          setInputValue(\"\");\n        } else {\n          const selectedValue = value as T | null | undefined;\n          setSearchResults(selectedValue ? [selectedValue] : []);\n          // Don't clear input for single selection - Base UI handles\n          // displaying the selected value via itemToStringLabel\n        }\n        setError(null);\n      }\n    },\n    [value, multiple],\n  );\n\n  // Cleanup on unmount\n  React.useEffect(() => {\n    return () => {\n      abortControllerRef.current?.abort();\n      if (debounceTimerRef.current) {\n        clearTimeout(debounceTimerRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    items,\n    comboboxProps: {\n      inputValue,\n      onInputValueChange: handleInputValueChange,\n      filter: null,\n      onOpenChangeComplete: handleOpenChangeComplete,\n    },\n    isPending,\n    error,\n    query,\n  };\n}\n",
      "type": "registry:hook",
      "target": "hooks/cubby-ui/use-async-combobox.ts"
    },
    {
      "path": "registry/default/combobox/hooks/use-creatable-combobox.ts",
      "content": "import * as React from \"react\";\n\nexport interface UseCreatableComboboxOptions<\n  T extends { id: string; value: string },\n> {\n  /**\n   * Controlled items for the combobox\n   */\n  items: T[];\n\n  /**\n   * Callback when items change\n   */\n  onItemsChange: (items: T[]) => void;\n\n  /**\n   * Controlled selected items\n   */\n  selectedItems: T[];\n\n  /**\n   * Callback when selected items change\n   */\n  onSelectedItemsChange: (items: T[]) => void;\n}\n\nexport interface UseCreatableComboboxReturn<\n  T extends { id: string; value: string },\n> {\n  /**\n   * Items array with pseudo \"Create X\" item injected when applicable\n   */\n  itemsWithCreatable: Array<T & { creatable?: string }>;\n\n  /**\n   * Props to spread onto the Combobox component\n   */\n  comboboxProps: {\n    value: T[];\n    onValueChange: (value: unknown) => void;\n    inputValue: string;\n    onInputValueChange: (value: string) => void;\n    onOpenChange: (\n      open: boolean,\n      details: { event: Event | React.SyntheticEvent },\n    ) => void;\n  };\n\n  /**\n   * Props to spread onto the Dialog component\n   */\n  dialogProps: {\n    open: boolean;\n    onOpenChange: (open: boolean) => void;\n  };\n\n  /**\n   * Props to spread onto the dialog input element\n   */\n  dialogInputProps: {\n    ref: React.RefObject<HTMLInputElement | null>;\n    defaultValue: string;\n  };\n\n  /**\n   * Form submit handler (handles preventDefault internally)\n   */\n  onDialogSubmit: (event: React.FormEvent<HTMLFormElement>) => void;\n\n  /**\n   * Dialog cancel handler\n   */\n  handleCancel: () => void;\n}\n\n/**\n * Slugify a string to create a valid ID\n */\nfunction slugify(value: string): string {\n  return value\n    .trim()\n    .toLowerCase()\n    .replace(/\\s+/g, \"-\")\n    .replace(/[^\\w-]/g, \"\");\n}\n\n/**\n * Generate a unique ID from a value, handling collisions\n */\nfunction generateUniqueId<T extends { id: string }>(\n  value: string,\n  existingItems: T[],\n): string {\n  const baseId = slugify(value);\n  const existingIds = new Set(existingItems.map((item) => item.id));\n\n  let uniqueId = baseId;\n  if (existingIds.has(uniqueId)) {\n    let counter = 2;\n    while (existingIds.has(`${baseId}-${counter}`)) {\n      counter += 1;\n    }\n    uniqueId = `${baseId}-${counter}`;\n  }\n\n  return uniqueId;\n}\n\n/**\n * Hook to manage creatable combobox state and logic\n *\n * This hook encapsulates all the complex logic needed for a creatable combobox:\n * - Injecting a pseudo \"Create X\" item when the query doesn't match existing items\n * - Handling item creation via a confirmation dialog with automatic ID generation\n * - Normalizing values and checking for duplicates\n *\n * @example\n * ```tsx\n * const [items, setItems] = useState(initialLabels);\n * const [selectedItems, setSelectedItems] = useState<LabelItem[]>([]);\n *\n * const { itemsWithCreatable, comboboxProps, dialogProps, dialogInputProps, onDialogSubmit, handleCancel } =\n *   useCreatableCombobox({\n *     items,\n *     onItemsChange: setItems,\n *     selectedItems,\n *     onSelectedItemsChange: setSelectedItems,\n *   });\n * ```\n */\nexport function useCreatableCombobox<T extends { id: string; value: string }>({\n  items,\n  onItemsChange,\n  selectedItems,\n  onSelectedItemsChange,\n}: UseCreatableComboboxOptions<T>): UseCreatableComboboxReturn<T> {\n  const [query, setQuery] = React.useState(\"\");\n  const [dialogOpen, setDialogOpen] = React.useState(false);\n  const [pendingValue, setPendingValue] = React.useState(\"\");\n\n  const inputRef = React.useRef<HTMLInputElement>(null);\n\n  // Helper to normalize values for comparison\n  const normalize = React.useCallback((value: string) => {\n    return value.trim().toLowerCase();\n  }, []);\n\n  // Helper to check if an item already exists\n  const itemExists = React.useCallback(\n    (value: string) => {\n      const normalized = normalize(value);\n      return items.some((item) => normalize(item.value) === normalized);\n    },\n    [items, normalize],\n  );\n\n  // Create the items array with pseudo \"Create X\" item if needed\n  const itemsWithCreatable = React.useMemo(() => {\n    const trimmed = query.trim();\n    if (!trimmed || itemExists(trimmed)) {\n      return items;\n    }\n\n    // Add pseudo item\n    const normalized = normalize(trimmed);\n    return [\n      ...items,\n      {\n        id: `create:${normalized}`,\n        value: `Create \"${trimmed}\"`,\n        creatable: trimmed,\n      } as T & { creatable: string },\n    ];\n  }, [items, query, itemExists, normalize]);\n\n  // Handle item creation\n  const handleCreate = React.useCallback(() => {\n    const value = pendingValue.trim();\n    if (!value) return;\n\n    // Check if item already exists\n    if (itemExists(value)) {\n      const existing = items.find(\n        (item) => normalize(item.value) === normalize(value),\n      );\n      if (\n        existing &&\n        !selectedItems.some((item) => item.id === existing.id)\n      ) {\n        onSelectedItemsChange([...selectedItems, existing]);\n      }\n      setDialogOpen(false);\n      setQuery(\"\");\n      setPendingValue(\"\");\n      return;\n    }\n\n    // Create new item with auto-generated ID\n    const id = generateUniqueId(value, items);\n    const newItem = { id, value } as T;\n\n    onItemsChange([...items, newItem]);\n    onSelectedItemsChange([...selectedItems, newItem]);\n    setDialogOpen(false);\n    setQuery(\"\");\n    setPendingValue(\"\");\n  }, [\n    pendingValue,\n    items,\n    selectedItems,\n    onItemsChange,\n    onSelectedItemsChange,\n    itemExists,\n    normalize,\n  ]);\n\n  // Handle value change from combobox\n  const handleValueChange = React.useCallback(\n    (value: unknown) => {\n      const valueArray = Array.isArray(value) ? value : value ? [value] : [];\n      const last = valueArray[valueArray.length - 1];\n\n      // Check if the last selected item is the pseudo \"Create X\" item\n      if (last && \"creatable\" in last && last.creatable) {\n        setPendingValue(last.creatable);\n        setDialogOpen(true);\n        return;\n      }\n\n      // Filter out any pseudo items and update selected\n      const cleanValue = valueArray.filter(\n        (item) => !(\"creatable\" in item && item.creatable),\n      );\n      onSelectedItemsChange(cleanValue as T[]);\n      setQuery(\"\");\n    },\n    [onSelectedItemsChange],\n  );\n\n  // Handle combobox open/close - intercept Enter key to open dialog\n  const handleOpenChange = React.useCallback(\n    (\n      open: boolean,\n      details: { event: Event | React.SyntheticEvent },\n    ) => {\n      // Check if Enter key was pressed with a query that doesn't match\n      if (\n        \"key\" in details.event &&\n        (details.event as KeyboardEvent).key === \"Enter\"\n      ) {\n        const trimmed = query.trim();\n        if (!trimmed) return;\n\n        // Check if item exists\n        if (itemExists(trimmed)) {\n          const existing = items.find(\n            (item) => normalize(item.value) === normalize(trimmed),\n          );\n          if (\n            existing &&\n            !selectedItems.some((item) => item.id === existing.id)\n          ) {\n            onSelectedItemsChange([...selectedItems, existing]);\n          }\n          setQuery(\"\");\n          return;\n        }\n\n        // Open dialog for new item creation\n        setPendingValue(trimmed);\n        setDialogOpen(true);\n      }\n    },\n    [query, items, selectedItems, itemExists, normalize, onSelectedItemsChange],\n  );\n\n  // Dialog submit handler\n  const onDialogSubmit = React.useCallback(\n    (event: React.FormEvent<HTMLFormElement>) => {\n      event.preventDefault();\n      handleCreate();\n    },\n    [handleCreate],\n  );\n\n  // Dialog cancel handler\n  const handleCancel = React.useCallback(() => {\n    setDialogOpen(false);\n    setPendingValue(\"\");\n  }, []);\n\n  return {\n    itemsWithCreatable,\n    comboboxProps: {\n      value: selectedItems,\n      onValueChange: handleValueChange,\n      inputValue: query,\n      onInputValueChange: setQuery,\n      onOpenChange: handleOpenChange,\n    },\n    dialogProps: {\n      open: dialogOpen,\n      onOpenChange: setDialogOpen,\n    },\n    dialogInputProps: {\n      ref: inputRef,\n      defaultValue: pendingValue,\n    },\n    onDialogSubmit,\n    handleCancel,\n  };\n}\n",
      "type": "registry:hook",
      "target": "hooks/cubby-ui/use-creatable-combobox.ts"
    }
  ]
}